<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title></title>
    <style>
      #formContainer {
        display: none;
      }
      
      .borderDiv {
        border: 2px solid black; /* Border width, style, and color */
        padding: 10px; /* Optional: Add padding inside the border */
        margin-bottom: 20px; /* Optional: Add margin at the bottom for spacing */
      }
    </style>
  </head>
  <body>
    <div>
      <div>
        <h2>TARGET Source</h2>
        <input type="text" id="apiInput">
        <button id="preload1">PRELOAD</button>
      </div>
      <div> 
        <h2>GET</h2>
        <button id="getDataBtn">Get Data</button>
      </div>
      <div>
      </div>
      <button id="toggleAddButton"> ADD TOGGLE </button>
    </div>
    <div id="blockContainer" class="borderDiv">
      <div id="formContainer">
        <h2> POST </h2>
        <form method="post" action="http://localhost:6003/api">
          <label for="name">Name:</label><br>
          <input type="text" id="name" name="name" required><br><br>
          <input type="submit" value="Submit">
        </form>
      </div>
    </div>

    <script>
      // Initialize a variable to store the input value
      let userInputValue = '';

      // Get the input element
      const userInput = document.getElementById('apiInput');

      // Add an event listener for the 'input' event
      userInput.addEventListener('input', function(event) {
          // Update the userInputValue variable as the user types
          userInputValue = event.target.value;

          // Log the updated value to the console (you can do other operations here)
          console.log(userInputValue);
      });

      document.getElementById('preload1').addEventListener('click', function() {
        userInputValue = 'http://localhost:6003/api';
        userInput.value = 'http://localhost:6003/api'; 
      });
      
      function sendDeleteRequest(blockId){
        let tempUri = userInputValue + '/' + blockId
        console.log(tempUri) 
        fetch(tempUri, {
          method: 'DELETE',
          headers: {
            'content-type': 'application/json',
          },
        })
        .then(response => {
            console.log('DATA deleted: ', response);
        })
        .catch(error =>{
          console.log('ERROR OCCURED: ', error);
        })
      }
      function sendGetRequest(){
        console.log(userInputValue);
        fetch(userInputValue) // Assuming your server endpoint is '/api/data'
            .then(response => response.json())
            .then(data => {
              //document.getElementById('jsonDataContainer').innerText = JSON.stringify(data, null, 2);
              // Display the received JSON data in the div
              data.forEach(object => {
                const objectDiv = document.createElement('div');
                // set content
                objectDiv.textContent = `Name: ${object.name} - id: ${object._id}`
                 
                // delete button 
                const deleteButton = document.createElement('button');
                deleteButton.textContent = 'X';
                deleteButton.addEventListener('click', function() {
                  // send out delete request
                  sendDeleteRequest(object._id); 
                  // potentially reload the get button
                  sendGetRequest()
                });
                // Append the div to container
                document.getElementById('blockContainer').appendChild(deleteButton)
                document.getElementById('blockContainer').appendChild(objectDiv)
              });
            })
            .catch(error => console.error('Error fetching data:', error));
      }

      
      document.getElementById('getDataBtn').addEventListener('click', function() {
          console.log(userInputValue);
          fetch(userInputValue) // Assuming your server endpoint is '/api/data'
              .then(response => response.json())
              .then(data => {
                //document.getElementById('jsonDataContainer').innerText = JSON.stringify(data, null, 2);
                // Display the received JSON data in the div
                data.forEach(object => {
                  const objectDiv = document.createElement('div');
                  // set content
                  objectDiv.textContent = `Name: ${object.name} - id: ${object._id}`
                   
                  // delete button 
                  const deleteButton = document.createElement('button');
                  deleteButton.textContent = 'X';
                  deleteButton.addEventListener('click', function() {
                    // send out delete request
                    sendDeleteRequest(object._id); 
                    // potentially reload the get button
                    sendGetRequest()
                  });
                  // Append the div to container
                  document.getElementById('blockContainer').appendChild(deleteButton)
                  document.getElementById('blockContainer').appendChild(objectDiv)
                });
              })
              .catch(error => console.error('Error fetching data:', error));
      });

    function togglePostForm(){
      const formContainer = document.getElementById('formContainer');
      const toggleButton = document.getElementById('toggleAddButton');
      // Toggle the display property of the formContainer
      if (formContainer.style.display == 'none') {
          formContainer.style.display = 'block';
          toggleButton.textContent = 'Hide Add Form';
      }
      else if (formContainer.style.display == '') {
          formContainer.style.display = 'block';
          toggleButton.textContent = 'Hide Add Form';
      } else {
          formContainer.style.display = 'none';
          toggleButton.textContent = 'ADD FORM';
      } 
    }

    document.getElementById('toggleAddButton').addEventListener('click', function() {
        togglePostForm();
    })
    </script>
  </body>
</html>
